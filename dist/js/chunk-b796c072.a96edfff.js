(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b796c072"],{"10c2":function(t,o,e){},"206c":function(t,o,e){},"3b76":function(t,o,e){"use strict";var s=e("10c2"),n=e.n(s);n.a},5055:function(t,o,e){"use strict";var s=e("9afc"),n=e.n(s);n.a},5573:function(t,o,e){"use strict";var s=e("796a"),n=e.n(s);n.a},"5f60":function(t,o,e){"use strict";var s=e("206c"),n=e.n(s);n.a},"796a":function(t,o,e){},9009:function(t,o,e){"use strict";e.r(o);var s=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",[e("navbar"),e("div",{staticClass:"route_container",style:t.posts.length?"padding-bottom: 8.5rem;":null},[e("confirm-modal",{attrs:{text:"Delete",color:"red"},on:{confirm:t.deleteThread},model:{value:t.showConfirmModal,callback:function(o){t.showConfirmModal=o},expression:"showConfirmModal"}},[t._v(" Вы действительно хотите удалить данный пост? "),e("br"),t._v("Этот пост "),e("b",[t._v("нельзя")]),t._v(" будет восстановить ")]),t.$store.state.thread.postNotification?e("thread-post-notification",{attrs:{post:t.$store.state.thread.postNotification},on:{close:function(o){return t.$store.commit("thread/setPostNotification",null)},goToPost:t.goToPostNotification}}):t._e(),e("header",{staticClass:"thread_header"},[e("div",{ref:"title",staticClass:"thread_header__thread_title"},[t._v(" "+t._s(t.thread)+" ")])]),e("div",{staticClass:"thread_side_bar"},[t.$store.state.thread.showRemovePostsButton?e("loading-button",{staticClass:"button--thin_text",class:{"button--disabled":!t.$store.state.thread.selectedPosts.length},attrs:{loading:t.$store.state.thread.removePostsButtonLoading,dark:!0},on:{click:t.removePosts}},[t._v(" Удалить ("+t._s(t.$store.state.thread.selectedPosts.length)+") ")]):t._e(),t.$store.state.admin?e("menu-button",{attrs:{options:[{event:"Заблокировать",value:t.$store.state.thread.locked?"Unlock thread":"Lock thread"},{event:"Удалить пост",value:"Delete thread"},{event:"Удалить комментарии",value:"Remove posts"}]},on:{lock_thread:t.setThreadLockedState,remove_posts:t.setThreadSelectState,delete_thread:function(o){t.showConfirmModal=!0}}},[e("button",{staticClass:"button button--thin_text"},[e("font-awesome-icon",{staticStyle:{"margin-right":"0.25rem"},attrs:{icon:["fa","cog"]}}),t._v(" Управление ")],1)]):t._e(),t.$store.state.thread.locked?t._e():e("button",{staticClass:"button button--thin_text",on:{click:t.replyThread}},[t._v(" "+t._s(t.replyThreadButton)+" ")]),e("post-scrubber",{attrs:{posts:t.$store.state.thread.totalPostsCount,value:t.$route.params.post_number||0},on:{input:t.goToPost}})],1),e("input-editor",{attrs:{show:t.editorState,replyUsername:t.replyUsername,loading:t.$store.state.thread.editor.loading},on:{mentions:t.setMentions,close:t.hideEditor,submit:t.addPost},model:{value:t.editor,callback:function(o){t.editor=o},expression:"editor"}}),t.$store.state.thread.locked?e("div",{staticClass:"locked_thread"},[e("h2",[t._v("Пост заблокирован ")]),t._v(" Вы не можете оставлять комментарии в этой теме, потому что она была заблокирована администратором ")]):t._e(),t.$store.state.thread.PollQuestionId?e("thread-poll",{attrs:{id:t.$store.state.thread.PollQuestionId}}):t._e(),e("div",{staticClass:"posts"},[e("scroll-load",{on:{loadNext:t.loadNextPosts,loadPrevious:t.loadPreviousPosts}},[t.posts.length?t._e():t._l(3,(function(t){return e("thread-post-placeholder",{key:"thread-post-placeholder-loading-"+t,class:{"post--last":2===t}})})),"previous"===t.$store.state.thread.loadingPosts?t._l(t.$store.state.thread.previousPostsCount,(function(t){return e("thread-post-placeholder",{key:"thread-post-placeholder-upper-"+t})})):t._e(),t._l(t.posts,(function(o,s){return e("thread-post",{key:"thread-post-"+o.id,ref:"posts",refInFor:!0,class:{"post--last":s===t.posts.length-1},attrs:{post:o,"show-reply":!t.$store.state.thread.locked,showSelect:t.$store.state.thread.showRemovePostsButton,highlight:t.highlightedPostIndex===s,allowQuote:!0},on:{reply:t.replyUser,goToPost:t.goToPost,selected:t.setSelectedPosts}})})),"next"===t.$store.state.thread.loadingPosts?t._l(t.$store.state.thread.nextPostsCount,(function(t){return e("thread-post-placeholder",{key:"thread-post-placeholder-lower-"+t})})):t._e()],2)],1)],1)],1)},n=[],i=(e("7db0"),e("c975"),e("4e82"),e("ac1f"),e("5319"),e("4795"),function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"input_editor input_editor--float",class:{"input_editor--hidden":!t.show,"input_editor--focus-input":t.focusInput}},[e("div",{staticClass:"input_editor__overlay",class:{"input_editor__overlay--show":t.loading}},[e("loading-icon")],1),t.replyUsername?e("div",{staticClass:"input_editor__reply_username"},[t._v("Ответ пользователю "),e("strong",[t._v(t._s(t.replyUsername))])]):t._e(),e("div",{staticClass:"input_editor__close input_editor__format_button",on:{click:t.closeEditor}},[t._v("×")]),e("tab-view",{attrs:{tabs:["Редактор","Превью"],"small-tabs":!0},model:{value:t.showTab,callback:function(o){t.showTab=o},expression:"showTab"}},[e("template",{slot:"Редактор"},[e("input-editor-core",{attrs:{value:t.value,"right-align-emoji":!0,error:t.error},on:{input:t.emitInput,mentions:t.emitMentions,focus:function(o){return t.setFocusInput(!0)},blur:function(o){return t.setFocusInput(!1)}}})],1),e("template",{slot:"Превью"},[e("input-editor-preview",{attrs:{value:t.value,mentions:t.mentions}})],1)],2),e("div",{staticClass:"input_editor__submit_bar"},[e("button",{staticClass:"button button--thin_text",on:{click:t.submit}},[t._v("Отправить")])])],1)}),a=[],r=(e("498a"),e("87e6")),l=e("b422"),c=e("c5af"),u=e("6334"),d={name:"InputEditor",props:["value","error","replyUsername","show","loading"],components:{InputEditorCore:r["a"],InputEditorPreview:l["a"],LoadingIcon:c["a"],TabView:u["a"]},data:function(){return{showTab:0,mentions:[],focusInput:!1}},methods:{submit:function(){this.value.trim().length&&this.$emit("submit")},closeEditor:function(){this.emitInput(""),this.$emit("close")},emitMentions:function(t){this.mentions=t,this.$emit("mentions",t)},emitInput:function(t){this.$emit("input",t)},setFocusInput:function(t){this.focusInput=t}},watch:{show:function(t){var o;t&&(this.showTab=0),o=this.$el.querySelector("textarea"),o&&o.focus()}}},h=d,p=(e("5055"),e("2877")),f=Object(p["a"])(h,i,a,!1,null,"4480a3a3",null),m=f.exports,_=e("8674"),v=e("1c59"),b=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("transition",{attrs:{name:"slide-fade"}},[e("div",{staticClass:"thread_post_notification",on:{click:function(o){return t.$emit("goToPost")}}},[e("span",{staticClass:"thread_post_notification__close",on:{click:function(o){return o.stopPropagation(),t.$emit("close")}}}),e("div",{staticClass:"thread_post_notification__header_bar"},[e("span",{staticClass:"thread_post_notification__username"},[t._v(t._s(t.post.username))]),t._v(" replied · click to view ")]),e("div",{staticClass:"thread_post_notification__content"},[t._v(t._s(t._f("truncate")(t._f("stripTags")(t.post.content),150)))])])])},$=[],g={name:"ThreadPostNotification",props:["post"]},w=g,P=(e("5f60"),Object(p["a"])(w,b,$,!1,null,"4591bc4c",null)),C=P.exports,k=e("eba0"),T=e("96cf"),y=e("8e8d"),x=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"poll"},[e("transition",{attrs:{name:"slide",mode:"out-in"}},[t.poll?e("div",{key:"poll"},[e("div",{staticClass:"poll__question"},[t._v(t._s(t.poll.question))]),"voting"!==t.view||t.poll.hasVoted?e("div",{staticClass:"poll__results_view"},[e("div",{staticClass:"poll__total_votes"},[t._v(" "+t._s(t.poll.totalVotes)+" "+t._s(t._f("pluralize")(t.poll.totalVotes,"total vote"))+" ")]),e("div",{staticClass:"poll__results"},t._l(t.poll.PollAnswers,(function(o,s){return e("div",{key:"poll-result-"+s,staticClass:"poll__result"},[e("div",[t._v(" "+t._s(o.answer)+" "),e("span",{staticClass:"poll__result__info"},[t._v(" · "+t._s(o.PollVotes.length)+" "+t._s(t._f("pluralize")(o.PollVotes.length,"vote"))+" ("+t._s(o.percent||0)+"%) ")])]),e("div",{staticClass:"poll__result__bar_outer"}),e("div",{staticClass:"poll__result__bar",style:{width:(o.percent||0)+"%"}})])})),0),t.poll.hasVoted?t._e():e("div",{staticClass:"poll__buttons"},[e("button",{staticClass:"button button--thin_text",on:{click:function(o){t.view="voting"}}},[t._v("Back")])])]):e("div",{staticClass:"poll__voting_view"},[e("div",{staticClass:"poll__answers"},t._l(t.poll.PollAnswers,(function(o,s){return e("div",{key:"poll-answer-"+s,staticClass:"poll__answer",class:{"poll__answer--selected":o===t.selected},on:{click:function(e){t.selected=o}}},[t._v(" "+t._s(o.answer)+" ")])})),0),e("div",{staticClass:"poll__buttons"},[e("loading-button",{staticClass:"button--blue",class:{"button--disabled":!t.selected},attrs:{loading:t.loading},on:{click:t.vote}},[t._v("Vote now")]),e("button",{staticClass:"button button--borderless button--thin_text",on:{click:function(o){t.view="results"}}},[t._v("Показать результаты")])],1)])]):e("div",{key:"loading",staticClass:"poll__loading"},[e("loading-icon",{attrs:{dark:!0}})],1)])],1)},I=[],S=e("c4b0"),M=e.n(S),N=e("2fa3"),E={name:"ThreadPoll",props:["id"],components:{LoadingIcon:c["a"],LoadingButton:y["a"]},data:function(){return{poll:null,view:"voting",selected:null,loading:!1}},methods:{vote:function(){var t=this;if(!this.$store.state.username)return this.$store.commit("setAccountTabs",0),void this.$store.commit("setAccountModalState",!0);this.loading=!0,this.axios.post(N["a"]+"/api/v1/poll/"+this.id,{answer:this.selected.answer}).then((function(o){t.poll=o.data,t.loading=!1,t.hasVoted=!0,t.view="results"}))["catch"]((function(o){t.loading=!1,M()(t.$store)(o)}))}},mounted:function(){var t=this;this.axios.get(N["a"]+"/api/v1/poll/"+this.id).then((function(o){return t.poll=o.data}))["catch"](M()(this.$store))}},O=E,B=(e("f61b"),Object(p["a"])(O,x,I,!1,null,"6b014353",null)),R=B.exports,L=e("da16"),A=e("d178"),V=e("bd28"),j=e("84a2"),U=e.n(j),q={name:"Thread",components:{Navbar:A["a"],InputEditor:m,ScrollLoad:_["a"],ThreadPost:v["a"],ThreadPostNotification:C,ThreadPostPlaceholder:k["a"],MenuButton:T["a"],LoadingButton:y["a"],ThreadPoll:R,ConfirmModal:L["a"]},data:function(){return{highlightedPostIndex:null,postNotification:null,showConfirmModal:!1}},computed:{thread:function(){return this.$store.state.thread.thread},posts:function(){return this.$store.getters.sortedPosts},replyUsername:function(){return this.$store.state.thread.reply.username},editor:{get:function(){return this.$store.state.thread.editor.value},set:function(t){this.$store.commit("setThreadEditorValue",t)}},editorState:function(){return this.$store.state.thread.editor.show},replyThreadButton:function(){return this.$store.state.username?"Оставить комментарий":"Авторизоваться"}},methods:{deleteThread:function(){this.$store.dispatch("deleteThread",this)},removePosts:function(){this.$store.dispatch("removePostsAsync",this)},setThreadLockedState:function(){this.$store.dispatch("setThreadLockedState",this)},setThreadSelectState:function(){this.$store.commit("setShowRemovePostsButton",!this.$store.state.thread.showRemovePostsButton)},setSelectedPosts:function(t){this.$store.commit("setSelectedPosts",t)},showEditor:function(){this.$store.commit("setThreadEditorState",!0)},hideEditor:function(){this.$store.commit("setThreadEditorState",!1),this.clearReply()},setMentions:function(t){this.$store.commit("setMentions",t)},clearReply:function(){this.$store.commit({type:"setReply",username:"",id:""})},replyThread:function(){this.$store.state.username?(this.clearReply(),this.showEditor()):(this.$store.commit("setAccountTabs",1),this.$store.commit("setAccountModalState",!0))},replyUser:function(t,o,e){this.$store.commit({type:"setReply",username:o,id:t,quote:e}),this.showEditor()},addPost:function(){this.$store.dispatch("addPostAsync",this)},loadNextPosts:function(){var t=this;this.$store.dispatch("loadPostsAsync",{vue:t,previous:!1})},loadPreviousPosts:function(){var t=this;this.$store.dispatch("loadPostsAsync",{vue:t,previous:!0})},loadInitialPosts:function(){this.$store.dispatch("loadInitialPostsAsync",this)},goToPost:function(t,o){var e=this,s=function(t){e.posts.find((function(o){return o.postNumber===t}))?e.highlightPost(t):(e.$router.replace({name:"thread-post",params:{post_number:t}}),e.loadInitialPosts())};o?this.axios.get(N["a"]+"/api/v1/post/"+t).then((function(t){return s(t.data.postNumber)})):s(t)},scrollTo:function(t,o){var e=this;this.$nextTick((function(){for(var s=function(t){var o=e.$refs.posts[t].$el.getBoundingClientRect().top,s=e.$refs.title.getBoundingClientRect().height;return window.pageYOffset+o-s-32},n=function(t){var n=e.posts[t];window.scrollTo(0,s(t)),o&&o(t,n)},i=0;i<e.posts.length;i++)if(e.posts[i].postNumber===t){e.$refs.posts?n(i):e.$nextTick((function(){return n(i)}));break}}))},highlightPost:function(t){var o=this;this.scrollTo(t,(function(e){o.highlightedPostIndex=e,o.$router.replace({name:"thread-post",params:{post_number:t}}),o.highlightedPostIndex===e&&setTimeout((function(){return o.highlightedPostIndex=null}),3e3)}))},showPostNotification:function(t){var o=this;t.username!==this.$store.state.username&&(this.$store.commit("thread/setPostNotification",null),this.$store.commit("thread/setPostNotification",t),setTimeout((function(){o.$store.commit("thread/setPostNotification",null)}),5e3))},goToPostNotification:function(){var t=this.$store.state.thread.postNotification;this.goToPost(t.postNumber),this.$store.commit("thread/setPostNotification",null)}},watch:{"$route.params.id":"loadInitialPosts"},mounted:function(){var t=this,o=this,e=function(){if(o.$refs.posts){var t=o.$refs.posts.sort((function(t,o){return t.post.postNumber-o.post.postNumber})),e=t.find((function(t){var o=t.$el.getBoundingClientRect();return o.top>=74&&o.bottom<=window.innerHeight})),s=t.indexOf(e);if(s>-1){var n=o.posts[s].postNumber;o.$router.replace({name:"thread-post",params:{post_number:n}})}}};document.addEventListener("scroll",U()(e,20)),this.loadInitialPosts(),this.$socket.emit("join","thread/"+this.$route.params.id),this.$socket.on("new post",(function(o){t.showPostNotification(o),t.$store.dispatch("loadNewPostsSinceLoad",o)})),Object(V["a"])("thread",this.$route.params.id)},destroyed:function(){this.$socket.emit("leave","thread/"+this.$route.params.id),this.$socket.off("new post")}},F=q,Q=(e("3b76"),Object(p["a"])(F,s,n,!1,null,"7b2dab06",null));o["default"]=Q.exports},"96cf":function(t,o,e){"use strict";var s=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("menu-tooltip",{staticClass:"menu_button",attrs:{top:"0",width:"10rem","touch-disabled":"true"},model:{value:t.menuOpen,callback:function(o){t.menuOpen=o},expression:"menuOpen"}},[e("div",{staticClass:"menu_button__icon",attrs:{slot:"button"},on:{click:function(o){t.menuOpen=!0}},slot:"button"},[t._t("default")],2),e("template",{slot:"menu"},t._l(t.options,(function(o,s){return e("div",{key:"menu-button-option-"+o.value+"-"+s,staticClass:"menu_button__option",style:{"border-bottom":s===t.options.length-1?"none":"solid thin rgb(245, 245, 245)"},on:{click:function(e){return t.emit(o.event)}}},[t._v(" "+t._s(o.value)+" ")])})),0)],2)},n=[],i=e("6fab"),a={name:"MenuButton",props:["options"],components:{MenuTooltip:i["a"]},data:function(){return{menuOpen:!1}},methods:{emit:function(t){this.$emit(t),this.menuOpen=!1}}},r=a,l=(e("5573"),e("2877")),c=Object(l["a"])(r,s,n,!1,null,"5d9f8334",null);o["a"]=c.exports},"9afc":function(t,o,e){},bcc2:function(t,o,e){},da16:function(t,o,e){"use strict";var s=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("modal-window",{attrs:{value:t.showModal},on:{input:t.setShowModal}},[e("div",{staticStyle:{"padding-top":"1rem"},attrs:{slot:"main"},slot:"main"},[t._t("default")],2),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("button",{staticClass:"button button--modal",class:t.buttonColor,on:{click:t.confirm}},[t._v(t._s(t.text||"OK"))]),e("button",{staticClass:"button button--modal",on:{click:function(o){return t.setShowModal(!1)}}},[t._v("Отмена")])])])},n=[],i=e("6307"),a={name:"ConfirmModal",props:["value","color","text"],components:{ModalWindow:i["a"]},data:function(){return{showModal:!1}},computed:{buttonColor:function(){return this.color?"button--"+this.color:""}},watch:{value:function(t){this.showModal=t}},methods:{setShowModal:function(t){this.showModal=t,this.$emit("input",t)},confirm:function(){this.$emit("confirm"),this.setShowModal(!1)}},mounted:function(){this.setShowModal(this.value)}},r=a,l=e("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);o["a"]=c.exports},f61b:function(t,o,e){"use strict";var s=e("bcc2"),n=e.n(s);n.a}}]);
//# sourceMappingURL=chunk-b796c072.a96edfff.js.map